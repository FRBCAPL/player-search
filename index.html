<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Player Search Portal with PIN</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; max-width: 600px; margin: auto; }
  #searchSection { display: none; }
  input, button { padding: 10px; margin-top: 10px; width: 100%; box-sizing: border-box; }
  button { background: #1976d2; color: white; border: none; cursor: pointer; }
  .player { padding: 10px; border: 1px solid #ddd; margin: 5px 0; }
</style>
</head>
<body>

<div id="pinSection">
  <h2>Enter PIN</h2>
  <input type="password" id="pinInput" placeholder="Enter your PIN" />
  <button onclick="verifyPin()">Submit</button>
  <div id="pinMessage" style="color:red; margin-top:10px;"></div>
</div>

<div id="searchSection">
  <h2>Player Search (Coming Soon)</h2>
  <p>PIN verified successfully!</p>
  <!-- You can add your player search UI here -->
</div>

<script>
const sheetID = "1tvMgMHsRwQxsR6lMNlSnztmwpK7fhZeNEyqjTqmRFRc";
const pinSheetName = "BCAPL SIGNUP";

async function verifyPin() {
  const pin = document.getElementById("pinInput").value.trim();
  if (!pin) {
    document.getElementById("pinMessage").innerText = "Please enter a PIN.";
    return;
  }
  document.getElementById("pinMessage").innerText = "Checking PIN...";

  try {
    const url = `https://docs.google.com/spreadsheets/d/${sheetID}/gviz/tq?tqx=out:json&sheet=${encodeURIComponent(pinSheetName)}`;
    const response = await fetch(url);
    const text = await response.text();
    // Parse JSONP response by removing prefix and suffix
    const json = JSON.parse(text.substr(47).slice(0, -2));
    const rows = json.table.rows;

    // Check if PIN exists in column L (index 11)
    const pinExists = rows.some(row => {
      const cell = row.c[11]; // column L
      return cell && cell.v && cell.v.toString() === pin;
    });

    if (pinExists) {
      document.getElementById("pinSection").style.display = "none";
      document.getElementById("searchSection").style.display = "block";
    } else {
      document.getElementById("pinMessage").innerText = "Invalid PIN. Please try again.";
    }

  } catch (error) {
    console.error("Error fetching sheet data:", error);
    document.getElementById("pinMessage").innerText = "Error verifying PIN. Please try again later.";
  }
}
</script>

</body>
</html>

